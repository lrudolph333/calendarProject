<!DOCTYPE html>
<html>
  <head>
    <title>Login - To Do</title>
  </head>
  <body>
    <h2>To Do</h2>
      <form id="loginInfo" method="post">
        <div>
        <p>Username: <input id="username" required type="text"/></p>
        <br>
        <p>Password: <input id="password" required type="password"/></p>
        <br>
        <input type="submit" id="loginbtn" value="Login"></input>
        <input type="submit" id="signupbtn" value="Sign Up"></input>
      </div>
    </form>
    <script>

      document.getElementById("loginInfo").addEventListener("submit", function(e) {

        e.preventDefault();

        var buttonPressed = document.querySelector("input[type=submit]:focus").id;

        var formData = new FormData();
        formData.append("username", document.querySelector("#username").value);
        formData.append("password", document.querySelector("#password").value);

        if(buttonPressed == "loginbtn") {
          login(formData);
        }
        else {
          signup(formData);
        }

      });

      function login(data) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            if(isNaN(xhttp.responseText)) {
              alert(xhttp.responseText);
            }
            else {
              loadDashboard(xhttp.responseText);
            }
          }
        };
        xhttp.open("POST", "/login", true);
        xhttp.send(data);
      }
      function signup(data) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            if(isNaN(xhttp.responseText)) {
              alert(xhttp.responseText);
            }
            else {
              loadDashboard(xhttp.responseText);
            }
          }
        };
        xhttp.open("POST", "/signup", true);
        xhttp.send(data);
      }

      function loadDashboard(userID) {

        var form = document.createElement('form');
        form.style.visibility = 'hidden';
        form.method = 'POST';
        form.action = 'dashboard.html';
        var key = document.createElement("input");
        key.name = "userID";
        key.value = userID;
        form.appendChild(key);
        document.body.appendChild(form);
        form.submit();

      }

    </script>
  </body>
</html>
