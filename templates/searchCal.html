<!DOCTYPE html>
<html>
  <head>
    <title>Search - To Do</title>
    <link rel="stylesheet" type="text/css" href="stylesheet/searchCal.css">
  </head>
  <body>
    <form method="post" id="searchForm">
      <h1>Search</h1>
      <p>Title: <input type="text" name="title"></p>
      <p>Date (MM/DD/YYYY): <input type="text" pattern="(?=\d)^(?:(?!(?:10\D(?:0?[5-9]|1[0-4])\D(?:1582))|(?:0?9\D(?:0?[3-9]|1[0-3])\D(?:1752)))((?:0?[13578]|1[02])|(?:0?[469]|11)(?!\/31)(?!-31)(?!\.31)|(?:0?2(?=.?(?:(?:29.(?!000[04]|(?:(?:1[^0-6]|[2468][^048]|[3579][^26])00))(?:(?:(?:\d\d)(?:[02468][048]|[13579][26])(?!\x20BC))|(?:00(?:42|3[0369]|2[147]|1[258]|09)\x20BC))))))|(?:0?2(?=.(?:(?:\d\D)|(?:[01]\d)|(?:2[0-8])))))([-.\/])(0?[1-9]|[12]\d|3[01])\2(?!0000)((?=(?:00(?:4[0-5]|[0-3]?\d)\x20BC)|(?:\d{4}(?!\x20BC)))\d{4}(?:\x20BC)?)(?:$|(?=\x20\d)\x20))?((?:(?:0?[1-9]|1[012])(?::[0-5]\d){0,2}(?:\x20[aApP][mM]))|(?:[01]\d|2[0-3])(?::[0-5]\d){1,2})?$" name="date"></p>
      <p>Time (HH:MM): <input type="text" pattern="(([0-1][0-9])|([2][0-3])):([0-5]+[0-9])" name="time"></p>
      <p>Location: <input type="text" name="location"></p>
      <input type="submit">
      <button onclick="back()">Cancel</button>
    </form>
    <script>

    function back() {
      var form = document.createElement('form');
      form.style.visibility = 'hidden';
      form.method = 'POST';
      form.action = 'calendar.html';
      var key = document.createElement("input");
      key.name = "userID";
      key.value = "{{userID}}";
      form.appendChild(key);
      var username = document.createElement("input");
      username.name = "username";
      username.value = "{{username}}";
      form.appendChild(username);
      document.body.appendChild(form);
      form.submit();
    }

      document.getElementById("searchForm").addEventListener("submit", function(e) {

        while(document.body.childNodes.length > 5) {
          document.body.removeChild(document.body.lastChild);
        }

        e.preventDefault();
        var formData = new FormData(document.getElementById("searchForm"));

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            eval("var data = " + xhttp.responseText);
            for(var i=0; i<data.length; i++) {
              var event = data[i];
              var newDiv = document.createElement("div");
              newDiv.classList.add("event");
              var title = document.createElement("p");
              title.innerHTML = "<strong>"+event.title+"</strong>"
              var description = document.createElement("p");
              description.innerHTML = event.time + " on " + event.date + " in " + event.location;
              newDiv.appendChild(title);
              newDiv.appendChild(description);
              document.body.appendChild(newDiv);
            }
          }
        };
        xhttp.open("POST", "/searchCalParser", true);
        xhttp.send(formData);

      });
    </script>
  </body>
</html>
